{"version":3,"sources":["scripts/mn-select.class.js"],"names":["MnSelect","self","_this2","_ret","_classCallCheck","this","classList","add","container","undefined","filterString","tabIndex","setMenu","setMobile","setSelected","setOptionEvents","setOpenEvents","setCloseEvents","setFormGetter","setValidation","_possibleConstructorReturn","tabindex","getAttribute","setAttribute","menu","document","createElement","style","transform","removeChild","querySelector","Array","from","children","forEach","child","option","text","textContent","split","map","char","join","test","innerHTML","attributes","attr","name","value","parentNode","appendChild","insertBefore","firstChild","options","cloneNode","cancelButton","removeAttribute","mobile","body","viewValue","selectedOption","clickToSelect","event","target","_this","close","focusOption","contains","remove","focusIn","arrowNavigate","isArrowKey","key","elementIsVisible","items","filter","item","index","indexOf","nextIndex","length","nextFocusable","stopPropagation","preventDefault","enterToSelect","isEnterKey","characterFilter","isCharacter","querySelectorAll","concat","addEventListener","clickToOpen","open","enterOrSpaceToOpen","isEnterOrSpaceKey","_this3","hasFilter","slice","clickOutside","closest","selectOption","form","element","Object","defineProperty","get","input","id","visibility","position","scrollTop","window","MnBackdrop","show","select","hide","lastFocus","optionTop","offsetTop","optionBottom","clientHeight","scrollToTop","scrollToBottom","_typeof","JSON","stringify","lastSelected","console","error","validate","changeEvent","CustomEvent","dispatchEvent","attrValue","parse","e","filterByRegex","search","RegExp","strReg","replace","reg","matches","match","matchIndex","matchValue","toLowerCase","hiddenOptions","chars","MnInput","customElements","define"],"mappings":"s/CAAMA,SAAAA,SAAAA,iBACJ,QAAAA,UAAYC,MAAM,GAAAC,QAAAC,IAchB,OAdgBC,iBAAAC,KAAAL,UAChBC,KAAAA,OAAAA,2BAAAA,MAAAA,SAAAA,WAAAA,OAAAA,eAAAA,WAAAA,KAAAA,KAAaA,OACbC,OAAKI,UAAUC,IAAI,aACnBL,OAAKM,cAAYC,GACjBP,OAAKQ,aAAe,GACpBR,OAAKS,WACLT,OAAKU,UACLV,OAAKW,YACLX,OAAKY,cACLZ,OAAKa,kBACLb,OAAKc,gBACLd,OAAKe,iBACLf,OAAKgB,gBACLhB,OAAKiB,gBACLhB,KAAOF,KAAPmB,2BAAAlB,OAAAC,yGAIA,GAAMkB,UAAWhB,KAAKiB,aAAa,aAAe,GAClDjB,MAAKkB,aAAa,WAAYF,4CAI9B,GAAMG,MAAOC,SAASC,cAAc,OACpCF,MAAKG,MAAMC,UAAY,yBAEvBvB,KAAKwB,YAAYxB,KAAKyB,cAAc,UAEpCN,KAAKlB,UAAUC,IAAI,WAEnBwB,MACGC,KAAK3B,KAAK4B,UACVC,QAAQ,SAAAC,OAEP,GAAMC,QAASX,SAASC,cAAc,MACtCU,QAAO9B,UAAUC,IAAI,mBAGrB,IAAM8B,MAAOF,MACVG,YACAC,MAAM,IACNC,IAAI,SAAAC,MAAA,MAAA,sBAA8BA,KAA9B,YACJC,KAAK,GAEc,UAASC,KAAKR,MAAMG,aAGxCF,OAAOE,YAAcH,MAAMG,YAE3BF,OAAOQ,UAAYP,KAGrBN,MACGC,KAAKG,MAAMU,YACXX,QAAQ,SAAAY,MAAA,MAAQV,QAAOb,aAAauB,KAAKC,KAAMD,KAAKE,SAEvDb,MAAMc,WAAWpB,YAAYM,OAC7BX,KAAK0B,YAAYd,UAGrB/B,KAAK8C,aAAa3B,KAAMnB,KAAK+C,YAC7B/C,KAAKmB,KAAOA,yCAIZ,GAAM6B,SAAU5B,SAASC,cAAc,OACjCF,KAAOnB,KAAKyB,cAAc,QAAQwB,WAAU,GAC5CC,aAAe9B,SAASC,cAAc,SAE5C2B,SAAQ/C,UAAUC,IAAI,oBACtBiB,KAAKgC,gBAAgB,SACrBhC,KAAKgC,gBAAgB,SACrBD,aAAajB,YAAc,SAE3BjC,KAAKoD,OAASJ,QACdA,QAAQH,YAAY1B,MACpB6B,QAAQH,YAAYK,cAEpB9B,SAASiC,KAAKR,YAAYG,+CAI1B,GAAMM,WAAYlC,SAASC,cAAc,OACnCkC,eAAiBvD,KAAKiB,aAAa,eACrCjB,KAAKyB,cAAc,+BACnBzB,KAAKyB,cAAc,gCAChBzB,KAAKyB,cAAc,oBAE1B,IAAI8B,eAAgB,CAClB,GAAMZ,OAAQY,eAAetC,aAAa,UAAYsC,eAAetB,WACrEjC,MAAK2C,MAAQA,MACb3C,KAAKC,UAAUC,IAAI,aACnBoD,UAAUrB,YAAcsB,eAAetB,gBAClC,IAAIjC,KAAKiB,aAAa,SAAU,CACrC,GAAM0B,QAAQ3C,KAAKiB,aAAa,QAChCjB,MAAK2C,MAAQA,MACb,IAAMZ,QAASX,SAASK,cAAT,4BAAmDkB,OAAnD,KAEXZ,UACFuB,UAAUrB,YAAcF,OAAOE,aAInCjC,KAAK8C,aAAaQ,UAAWtD,KAAK+C,sDAmBlC,QAASS,eAAcC,OACrB,GAAMd,OAAQc,MAAMC,OAAOzC,aAAa,UAAYwC,MAAMC,OAAOzB,WACjE0B,OAAMhB,MAAQA,MACdgB,MAAMC,QAGR,QAASC,aAAYJ,OACfE,MAAM1D,UAAU6D,SAAS,aAC3BH,MAAM1D,UAAU8D,OAAO,aAEvBJ,MAAMK,QAAQP,MAAMC,QAIxB,QAASO,eAAcR,OACrB,GAAMS,YAA2B,cAAdT,MAAMU,KAAqC,YAAdV,MAAMU,IAChDC,iBAAmBT,MAAM1D,UAAU6D,SAAS,UAElD,IAAII,YAAcE,iBAAkB,CAClC,GAAMC,OAAQ3C,MACXC,KAAKgC,MAAMxC,KAAKS,UAChB0C,OAAO,SAAAC,MACN,OAAQA,KAAKtE,UAAU6D,SAAS,YAG9BU,MAAQH,MAAMI,QAAQd,MAAMlC,cAAc,4BAE1CiD,UAA0B,cAAdjB,MAAMU,KAAuBK,MAAQH,MAAMM,OACzDH,MAAQ,EACM,YAAdf,MAAMU,KAAqBK,MAAQ,EACjCA,MAAQ,EACR,EAEAI,cAAgBP,MAAMK,UAExBR,aAAcU,gBAChBjB,MAAMK,QAAQY,eACdnB,MAAMoB,kBACNpB,MAAMqB,mBAKZ,QAASC,eAActB,OACrB,GAAMuB,YAA2B,UAAdvB,MAAMU,IACnBC,iBAAmBT,MAAM1D,UAAU6D,SAAS,WAC5C/B,OAAS4B,MAAMxC,KAAKM,cAAc,SAExC,IAAIuD,YAAcZ,kBAAoBrC,OAAQ,CAC5C,GAAMY,OAAQZ,OAAOd,aAAa,UAAYc,OAAOE,WACrD0B,OAAMhB,MAAQA,MACdgB,MAAMC,SAIV,QAASqB,iBAAgBxB,OACvB,GAAMyB,aAAmC,IAArBzB,MAAMU,IAAIQ,QAA8B,MAAdlB,MAAMU,IAC9CC,iBAAmBT,MAAM1D,UAAU6D,SAAS,UAE9CoB,cAAed,mBACjBT,MAAMtD,cAAgBoD,MAAMU,IAC5BR,MAAMW,OAASX,MAAMtD,cA5EzB,GAAM2C,SAAUtB,MAAMC,KAAK3B,KAAKmF,iBAAiB,sBAC3C/B,OAAS1B,MAAMC,KAAK3B,KAAKoD,OAAO+B,iBAAiB,sBACjDxB,MAAQ3D,IAEdgD,SACGoC,OAAOhC,QACPvB,QAAQ,SAAAE,QAAA,MAAUA,QAAOsD,iBAAiB,QAAS7B,iBAEtDR,QACGnB,QAAQ,SAAAE,QAAA,MAAUA,QAAOsD,iBAAiB,YAAaxB,eAE1DzC,SAASiE,iBAAiB,UAAWpB,eACrC7C,SAASiE,iBAAiB,UAAWN,eACrC3D,SAASiE,iBAAiB,UAAWJ,yDAyErC,QAASK,gBACkB3B,MAAM1D,UAAU6D,SAAS,YAC7BH,MAAM4B,OAG7B,QAASC,oBAAmB/B,OAC1B,GAAMgC,mBAAkC,UAAdhC,MAAMU,KACb,MAAdV,MAAMU,IACLC,iBAAmBT,MAAM1D,UAAU6D,SAAS,UAE9C2B,qBAAsBrB,mBACxBT,MAAM4B,OACN9B,MAAMqB,iBACNrB,MAAMoB,mBAjBV,GAAMlB,OAAQ3D,IACdA,MAAKqF,iBAAiB,QAASC,aAC/BtF,KAAKqF,iBAAiB,UAAWG,6DAoBlB,GAAAE,QAAA1F,IACfA,MAAKqF,iBAAiB,QAAS,WAAA,MAAMK,QAAK9B,UAC1C5D,KAAKoD,OAAO3B,cAAc,UAAU4D,iBAAiB,QAAS,WAAA,MAAMK,QAAK9B,UACzE5D,KAAKoD,OAAOiC,iBAAiB,QAAS,SAAA5B,OAChCA,MAAMC,OAAOzD,UAAU6D,SAAS,qBAClC4B,OAAK9B,UAITxC,SAASiE,iBAAiB,UAAW,SAAA5B,OACnC,GAAMkC,WAAYD,OAAKrF,YACNqF,QAAKzF,UAAU6D,SAAS,aAGrB,cAAdL,MAAMU,MACRuB,OAAKrF,aAAeqF,OAAKrF,aAAauF,MAAM,GAAI,GAChDF,OAAKpB,OAASoB,OAAKrF,cAGH,QAAdoD,MAAMU,KACRuB,OAAK9B,QAGW,WAAdH,MAAMU,MACJwB,UACFD,OAAKpB,WAASlE,GAEdsF,OAAK9B,YAMbxC,SAASiE,iBAAiB,QAAS,SAAA5B,OACjC,GAAMW,kBAAmBsB,OAAKzF,UAAU6D,SAAS,WAC3C+B,aAAeH,OAAKvF,WACrBsD,MAAMC,OAAOoC,QAAQJ,OAAKvF,YAC1BsD,MAAMC,OAAOoC,QAAQ,aACpBC,aAAetC,MAAMC,OAAOzD,UAAU6D,SAAS,qBACjDM,kBAAoByB,cAAgBE,eACtCL,OAAK9B,kDAMT,GAAMoC,MAAOhG,KAAK8F,QAAQ,QACpBpD,KAAO1C,KAAKiB,aAAa,QACzBgF,QAAUjG,IAEZgG,OAAQtD,MACVwD,OAAOC,eAAeH,KAAMtD,MAAO0D,IAAK,WAAA,MAAMH,oDAMhD,GADiBjG,KAAKiB,aAAa,YACrB,CACZ,GAAMoF,OAAQjF,SAASC,cAAc,QACrCgF,OAAMnF,aAAa,WAAY,YAC/BmF,MAAMnF,aAAa,OAAQlB,KAAKiB,aAAa,SAAWjB,KAAKsG,IAC7DD,MAAM/E,MAAMiF,WAAa,SACzBF,MAAM/E,MAAMkF,SAAW,WACvBxG,KAAK6C,YAAYwD,uCA8GnBrG,KAAK4D,QACL5D,KAAKmB,KAAKsF,UAAY,EACtBzG,KAAKC,UAAUC,IAAI,WACnBF,KAAKoD,OAAOnD,UAAUC,IAAI,WAC1BkB,SAASiC,KAAKpD,UAAUC,IAAI,qBAC5BwG,OAAOC,WAAWC,OAClB5G,KAAKgE,QAAQhE,KAAKyB,cAAc,sDAIhC,GAAMoF,QAASzF,SAASK,cAAc,oBAElCoF,UACFA,OAAO5G,UAAU8D,OAAO,WACxB8C,OAAOvC,WAASlE,GAChByG,OAAOzD,OAAOnD,UAAU8D,OAAO,WAC/B3C,SAASiC,KAAKpD,UAAU8D,OAAO,qBAC/B2C,OAAOC,WAAWG,wCAId/E,QACN,GAAIA,SAAWA,OAAO9B,UAAU6D,SAAS,SAAU,CACjD,GAAMiD,WAAY/G,KAAKyB,cAAc,0BACrCsF,YAAaA,UAAU9G,UAAU8D,OAAO,SACxChC,OAAO9B,UAAUC,IAAI,QAErB,IAAM8G,WAAYjF,OAAOkF,UACnBC,aAAeF,UAAYjF,OAAOoF,aAElCC,YAAcJ,UAAYhH,KAAKmB,KAAKsF,UACpCY,eAAiBH,aAAelH,KAAKmB,KAAKsF,UAAYzG,KAAKmB,KAAKgG,YAEtEnH,MAAKC,UAAUC,IAAI,aACfkH,YACFpH,KAAKmB,KAAKsF,UAAYO,UACbK,iBACTrH,KAAKmB,KAAKsF,UAAYS,aAAelH,KAAKmB,KAAKgG,2CA/I3CxE,OACRA,MAAyB,gBAAjB,KAAOA,MAAP,YAAA2E,QAAO3E,QACX4E,KAAKC,UAAU7E,OACfA,KAEJ,IAAMZ,QAAS/B,KAAKyB,cAAL,4BAA+CkB,MAA/C,MACT0D,MAAQrG,KAAKyB,cAAc,QAEjC,IAAIM,OAAQ,CACV,GAAMuB,WAAYtD,KAAKyB,cAAc,6BACrC6B,aACIA,UAAUrB,YAAcF,OAAOE,aAE/BoE,QACFA,MAAM1D,MAAQA,OAEhB3C,KAAKC,UAAUC,IAAI,YACnB,IAAMuH,cAAe1F,OAAOa,WAAWnB,cAAc,8BAEjDgG,eACFA,aAAatE,gBAAgB,YAE/BpB,OAAOb,aAAa,WAAY,gBAEhCwG,SAAQC,MAAR,kEAC+BhF,MAD/B,kFAKF3C,MAAK4H,UACL,IAAMC,aAAc,GAAIC,aAAY,UAAWnF,MAAAA,OAC/C3C,MAAK+H,cAAcF,aACnB7H,KAAKkB,aAAa,QAASyB,uBAK3B,GAAIqF,eAAAA,EAEJ,KACEA,UAAYhI,KAAKiB,aAAa,SAC1BsG,KAAKU,MAAMjI,KAAKiB,aAAa,UAC7BjB,KAAKiB,aAAa,SACtB,MAAOiH,GACPF,UAAYhI,KAAKiB,aAAa,SAGhC,MAAO+G,gBAAa5H,gCAGXuC,OA6CT,QAASwF,eAAcC,OAAQzF,OAE7B,MADY,IAAI0F,QAAOD,OAAOlG,MAAM,IAAIG,KAAK,MAAO,KACzCC,KAAKK,OA9ClB,GAAIA,MAAO,CACT3C,KAAKC,UAAUC,IAAI,YACnBF,KAAKK,aAAesC,KACJjB,OAAMC,KAAK3B,KAAKmB,KAAKgE,iBAAiB,sBAC9CtD,QAAQ,SAAAE,QAGd,GAFoBoG,cAAcxF,MAAOZ,OAAOE,aAE/B,CACfF,OAAO9B,UAAU8D,OAAO,SACxB,IAAMuE,QAAS3F,MACVT,MAAM,IACNG,KAAK,MACLkG,QAAQ,iBAAkB,QACzBC,IAAM,GAAIH,QAAOC,OAAQ,KACzBG,QAAU1G,OAAOE,YAAYyG,MAAMF,IAC3B9G,OAAMC,KAAKI,OAAOoD,iBAAiB,SAG9CtD,QAAQ,SAACO,KAAMoC,OACd,GAAMmE,YAAanE,OAASiE,QAAQjE,MAC9BoE,WAAajG,MAAMkG,cAAcT,OAAOhG,KAAKH,YAAY4G,gBAAkB,CAE7EF,aAAcC,WAChBxG,KAAKnC,UAAUC,IAAI,gBAEnBkC,KAAKnC,UAAU8D,OAAO,kBAG5BpB,MAAMT,MAAM,QAEZH,QAAO9B,UAAUC,IAAI,gBAGpB,CACLF,KAAKC,UAAU8D,OAAO,YACtB/D,KAAKK,aAAe,EACpB,IAAMyI,eAAgBpH,MAAMC,KAAK3B,KAAKmF,iBAAiB,6BACjD4D,MAAQrH,MAAMC,KAAK3B,KAAKmF,iBAAiB,uCAC/C2D,eAAcjH,QAAQ,SAAAE,QAAA,MAAUA,QAAO9B,UAAU8D,OAAO,YACxDgF,MAAMlH,QAAQ,SAAAO,MAAA,MAAQA,MAAKnC,UAAU8D,OAAO,kBAG9C/D,KAAKgE,QAAQhE,KAAKyB,cAAc,mDAShC,MAAOzB,MAAKK,kBAAgBD,iBA7XTsG,OAAOsC,QA4a9BtC,QAAOuC,eAAeC,OAAO,YAAavJ","file":"mn-select.js","sourcesContent":["class MnSelect extends window.MnInput {\n  constructor(self) {\n    self = super(self)\n    this.classList.add('mn-select')\n    this.container = undefined\n    this.filterString = ''\n    this.tabIndex()\n    this.setMenu()\n    this.setMobile()\n    this.setSelected()\n    this.setOptionEvents()\n    this.setOpenEvents()\n    this.setCloseEvents()\n    this.setFormGetter()\n    this.setValidation()\n    return self\n  }\n\n  tabIndex() {\n    const tabindex = this.getAttribute('tabindex') || '0'\n    this.setAttribute('tabindex', tabindex)\n  }\n\n  setMenu() {\n    const menu = document.createElement('menu')\n    menu.style.transform = 'translate(-19px, -5px)'\n    // inherit from .mn-input\n    this.removeChild(this.querySelector('input'))\n\n    menu.classList.add('mn-card')\n\n    Array\n      .from(this.children)\n      .forEach(child => {\n        // fallback option, some browsers dont support tag option\n        const option = document.createElement('div')\n        option.classList.add('mn-select-option')\n\n        // wrap in a span\n        const text = child\n          .textContent\n          .split('')\n          .map(char => `<span class=\"char\">${char}</span>`)\n          .join('')\n\n        const isDataBinding = /{{.+}}/.test(child.textContent)\n\n        if (isDataBinding) {\n          option.textContent = child.textContent\n        } else {\n          option.innerHTML = text\n        }\n\n        Array\n          .from(child.attributes)\n          .forEach(attr => option.setAttribute(attr.name, attr.value))\n\n        child.parentNode.removeChild(child)\n        menu.appendChild(option)\n      })\n\n    this.insertBefore(menu, this.firstChild)\n    this.menu = menu\n  }\n\n  setMobile() {\n    const options = document.createElement('div')\n    const menu = this.querySelector('menu').cloneNode(true)\n    const cancelButton = document.createElement('button')\n\n    options.classList.add('mn-select-mobile')\n    menu.removeAttribute('class')\n    menu.removeAttribute('style')\n    cancelButton.textContent = 'cancel'\n\n    this.mobile = options\n    options.appendChild(menu)\n    options.appendChild(cancelButton)\n\n    document.body.appendChild(options)\n  }\n\n  setSelected() {\n    const viewValue = document.createElement('div')\n    const selectedOption = this.getAttribute('placeholder')\n      ? this.querySelector('.mn-select-option[selected]')\n      : this.querySelector('.mn-select-option[selected]')\n        || this.querySelector('.mn-select-option')\n\n    if (selectedOption) {\n      const value = selectedOption.getAttribute('value') || selectedOption.textContent\n      this.value = value\n      this.classList.add('has-value')\n      viewValue.textContent = selectedOption.textContent\n    } else if (this.getAttribute('value')) {\n      const value = this.getAttribute('value')\n      this.value = value\n      const option = document.querySelector(`.mn-select-option[value='${value}']`)\n\n      if (option) {\n        viewValue.textContent = option.textContent\n      }\n    }\n\n    this.insertBefore(viewValue, this.firstChild)\n  }\n\n  setOptionEvents() {\n    const options = Array.from(this.querySelectorAll('.mn-select-option'))\n    const mobile = Array.from(this.mobile.querySelectorAll('.mn-select-option'))\n    const _this = this\n\n    options\n      .concat(mobile)\n      .forEach(option => option.addEventListener('click', clickToSelect))\n\n    options\n      .forEach(option => option.addEventListener('mousemove', focusOption))\n\n    document.addEventListener('keydown', arrowNavigate)\n    document.addEventListener('keydown', enterToSelect)\n    document.addEventListener('keydown', characterFilter)\n\n    function clickToSelect(event) {\n      const value = event.target.getAttribute('value') || event.target.textContent\n      _this.value = value\n      _this.close()\n    }\n\n    function focusOption(event) {\n      if (_this.classList.contains('arrow-key')) {\n        _this.classList.remove('arrow-key')\n      } else {\n        _this.focusIn(event.target)\n      }\n    }\n\n    function arrowNavigate(event) {\n      const isArrowKey = event.key === 'ArrowDown' || event.key === 'ArrowUp'\n      const elementIsVisible = _this.classList.contains('visible')\n\n      if (isArrowKey && elementIsVisible) {\n        const items = Array\n          .from(_this.menu.children)\n          .filter(item => {\n            return !item.classList.contains('hidden')\n          })\n\n        const index = items.indexOf(_this.querySelector('.mn-select-option.focus'))\n\n        const nextIndex = event.key === 'ArrowDown' && index < items.length\n          ? index + 1\n          : event.key === 'ArrowUp' && index > 0\n            ? index - 1\n            : 0\n\n        const nextFocusable = items[nextIndex]\n\n        if (isArrowKey && nextFocusable) {\n          _this.focusIn(nextFocusable)\n          event.stopPropagation()\n          event.preventDefault()\n        }\n      }\n    }\n\n    function enterToSelect(event) {\n      const isEnterKey = event.key === 'Enter'\n      const elementIsVisible = _this.classList.contains('visible')\n      const option = _this.menu.querySelector('.focus')\n\n      if (isEnterKey && elementIsVisible && option) {\n        const value = option.getAttribute('value') || option.textContent\n        _this.value = value\n        _this.close()\n      }\n    }\n\n    function characterFilter(event) {\n      const isCharacter = event.key.length === 1 && event.key !== ' '\n      const elementIsVisible = _this.classList.contains('visible')\n\n      if (isCharacter && elementIsVisible) {\n        _this.filterString += event.key\n        _this.filter = _this.filterString\n      }\n    }\n  }\n\n  setOpenEvents() {\n    const _this = this\n    this.addEventListener('click', clickToOpen)\n    this.addEventListener('keydown', enterOrSpaceToOpen)\n\n    function clickToOpen() {\n      const elementIsVisible = _this.classList.contains('visible')\n      !elementIsVisible && _this.open()\n    }\n\n    function enterOrSpaceToOpen(event) {\n      const isEnterOrSpaceKey = event.key === 'Enter'\n        || event.key === ' '\n      const elementIsVisible = _this.classList.contains('visible')\n\n      if (isEnterOrSpaceKey && !elementIsVisible) {\n        _this.open()\n        event.preventDefault()\n        event.stopPropagation()\n      }\n    }\n  }\n\n  setCloseEvents() {\n    this.addEventListener('focus', () => this.close())\n    this.mobile.querySelector('button').addEventListener('click', () => this.close())\n    this.mobile.addEventListener('click', event => {\n      if (event.target.classList.contains('mn-select-mobile')) {\n        this.close()\n      }\n    })\n\n    document.addEventListener('keydown', event => {\n      const hasFilter = this.filterString\n      const isOpened = this.classList.contains('visible')\n\n      if (isOpened) {\n        if (event.key === 'Backspace') {\n          this.filterString = this.filterString.slice(0, -1)\n          this.filter = this.filterString\n        }\n\n        if (event.key === 'Tab') {\n          this.close()\n        }\n\n        if (event.key === 'Escape') {\n          if (hasFilter) {\n            this.filter = undefined\n          } else {\n            this.close()\n          }\n        }\n      }\n    })\n\n    document.addEventListener('click', event => {\n      const elementIsVisible = this.classList.contains('visible')\n      const clickOutside = this.container\n        ? !event.target.closest(this.container)\n        : !event.target.closest('mn-select')\n      const selectOption = event.target.classList.contains('mn-select-option')\n      if (elementIsVisible && clickOutside || selectOption) {\n        this.close()\n      }\n    })\n  }\n\n  setFormGetter() {\n    const form = this.closest('form')\n    const name = this.getAttribute('name')\n    const element = this\n\n    if (form && name) {\n      Object.defineProperty(form, name, {get: () => element})\n    }\n  }\n\n  setValidation() {\n    const required = this.getAttribute('required')\n    if (required) {\n      const input = document.createElement('input')\n      input.setAttribute('required', 'required')\n      input.setAttribute('name', this.getAttribute('name') || this.id)\n      input.style.visibility = 'hidden'\n      input.style.position = 'absolute'\n      this.appendChild(input)\n    }\n  }\n\n  set value(value) {\n    value = typeof value === 'object'\n      ? JSON.stringify(value)\n      : value\n\n    const option = this.querySelector(`.mn-select-option[value='${value}']`)\n    const input = this.querySelector('input')\n\n    if (option) {\n      const viewValue = this.querySelector('div:not(.mn-select-option)')\n      viewValue\n        ? viewValue.textContent = option.textContent\n        : null\n      if (input) {\n        input.value = value\n      }\n      this.classList.add('has-value')\n      const lastSelected = option.parentNode.querySelector('.mn-select-option[selected]')\n\n      if (lastSelected) {\n        lastSelected.removeAttribute('selected')\n      }\n      option.setAttribute('selected', 'selected')\n    } else {\n      console.error(`MN-SELECT OPTION_UNDEFINED\n        You're trying set a value (${value}) to mn-select,\n        but there is no option with this value to be displayed`)\n    }\n\n    this.validate()\n    const changeEvent = new CustomEvent('change', {value})\n    this.dispatchEvent(changeEvent)\n    this.setAttribute('value', value)\n  }\n\n  get value() {\n    // return evaluate(this.getAttribute('value')) || undefined\n    let attrValue\n\n    try {\n      attrValue = this.getAttribute('value')\n        ? JSON.parse(this.getAttribute('value'))\n        : this.getAttribute('value')\n    } catch (e) {\n      attrValue = this.getAttribute('value')\n    }\n\n    return attrValue || undefined\n  }\n\n  set filter(value) {\n    if (value) {\n      this.classList.add('filtered')\n      this.filterString = value\n      const options = Array.from(this.menu.querySelectorAll('.mn-select-option'))\n      options.forEach(option => {\n        const matchOption = filterByRegex(value, option.textContent)\n\n        if (matchOption) {\n          option.classList.remove('hidden')\n          const strReg = value\n              .split('')\n              .join('.*')\n              .replace(/(\\w(?:\\.\\*)?)/g, '($1)')\n          const reg = new RegExp(strReg, 'i')\n          const matches = option.textContent.match(reg)\n          const chars = Array.from(option.querySelectorAll('span'))\n\n          chars\n            .forEach((char, index) => {\n              const matchIndex = index >= matches.index\n              const matchValue = value.toLowerCase().search(char.textContent.toLowerCase()) >= 0\n\n              if (matchIndex && matchValue) {\n                char.classList.add('filter-match')\n              } else {\n                char.classList.remove('filter-match')\n              }\n            })\n          value.split('')\n        } else {\n          option.classList.add('hidden')\n        }\n      })\n    } else {\n      this.classList.remove('filtered')\n      this.filterString = ''\n      const hiddenOptions = Array.from(this.querySelectorAll('.mn-select-option.hidden'))\n      const chars = Array.from(this.querySelectorAll('.mn-select-option span.filter-match'))\n      hiddenOptions.forEach(option => option.classList.remove('hidden'))\n      chars.forEach(char => char.classList.remove('filter-match'))\n    }\n\n    this.focusIn(this.querySelector('.mn-select-option:not(.hidden)'))\n\n    function filterByRegex(search, value) {\n      const reg = new RegExp(search.split('').join('.*'), 'i')\n      return reg.test(value)\n    }\n  }\n\n  get filter() {\n    return this.filterString || undefined\n  }\n\n  open() {\n    this.close()\n    this.menu.scrollTop = 0\n    this.classList.add('visible')\n    this.mobile.classList.add('visible')\n    document.body.classList.add('mn-select-visible')\n    window.MnBackdrop.show()\n    this.focusIn(this.querySelector('.mn-select-option'))\n  }\n\n  close() {\n    const select = document.querySelector('mn-select.visible')\n\n    if (select) {\n      select.classList.remove('visible')\n      select.filter = undefined\n      select.mobile.classList.remove('visible')\n      document.body.classList.remove('mn-select-visible')\n      window.MnBackdrop.hide()\n    }\n  }\n\n  focusIn(option) {\n    if (option && !option.classList.contains('focus')) {\n      const lastFocus = this.querySelector('.mn-select-option.focus')\n      lastFocus && lastFocus.classList.remove('focus')\n      option.classList.add('focus')\n\n      const optionTop = option.offsetTop\n      const optionBottom = optionTop + option.clientHeight\n\n      const scrollToTop = optionTop < this.menu.scrollTop\n      const scrollToBottom = optionBottom > this.menu.scrollTop + this.menu.clientHeight\n\n      this.classList.add('arrow-key')\n      if (scrollToTop) {\n        this.menu.scrollTop = optionTop\n      } else if (scrollToBottom) {\n        this.menu.scrollTop = optionBottom - this.menu.clientHeight\n      }\n    }\n  }\n}\n\nwindow.customElements.define('mn-select', MnSelect)\n\n"]}