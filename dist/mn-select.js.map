{"version":3,"sources":["scripts/mn-select.class.js"],"names":["MnSelect","self","_this","_ret","_classCallCheck","this","filterString","tabIndex","setMenu","setMobile","setSelected","setOptionEvents","setOpenEvents","setCloseEvents","setFormGetter","setValidation","_possibleConstructorReturn","tabindex","getAttribute","setAttribute","menu","document","createElement","style","transform","removeChild","querySelector","classList","add","Array","from","children","forEach","child","option","textContent","attributes","attr","name","value","parentNode","appendChild","insertBefore","firstChild","options","cloneNode","cancelButton","removeAttribute","mobile","body","viewValue","selectedOption","_this2","querySelectorAll","concat","addEventListener","event","target","close","focus","remove","nextFocusable","key","nextElementSibling","previousElementSibling","stopPropagation","preventDefault","_this3","open","focusOption","_this4","contains","hasFilter","esc","isOpened","isCharacter","length","filter","slice","undefined","clickOutside","closest","selectOption","form","element","Object","defineProperty","get","input","id","visibility","position","window","MnBackdrop","show","select","hide","type","elementFromPoint","clientX","clientY","_typeof","JSON","stringify","lastSelected","console","error","validate","changeEvent","CustomEvent","dispatchEvent","attrValue","parse","e","filterByRegex","search","RegExp","split","join","test","MnInput","customElements","define"],"mappings":"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","file":"mn-select.js","sourcesContent":["class MnSelect extends window.MnInput {\n  constructor(self) {\n    self = super(self)\n    this.filterString = ''\n    this.tabIndex()\n    this.setMenu()\n    this.setMobile()\n    this.setSelected()\n    this.setOptionEvents()\n    this.setOpenEvents()\n    this.setCloseEvents()\n    this.setFormGetter()\n    this.setValidation()\n    return self\n  }\n\n  tabIndex() {\n    const tabindex = this.getAttribute('tabindex') || '0'\n    this.setAttribute('tabindex', tabindex)\n  }\n\n  setMenu() {\n    const menu = document.createElement('menu')\n    menu.style.transform = 'translate(-19px, -5px)'\n    // inherit from .mn-input\n    this.removeChild(this.querySelector('input'))\n\n    menu.classList.add('mn-card')\n\n    Array\n      .from(this.children)\n      .forEach(child => {\n        // fallback option, some browsers dont support tag option\n        const option = document.createElement('div')\n        option.classList.add('mn-select-option')\n        option.textContent = child.textContent\n        option.setAttribute('tabindex', '-1')\n\n        Array\n          .from(child.attributes)\n          .forEach(attr => option.setAttribute(attr.name, attr.value))\n\n        child.parentNode.removeChild(child)\n        menu.appendChild(option)\n      })\n\n    this.insertBefore(menu, this.firstChild)\n    this.menu = menu\n  }\n\n  setMobile() {\n    const options = document.createElement('div')\n    const menu = this.querySelector('menu').cloneNode(true)\n    const cancelButton = document.createElement('button')\n\n    options.classList.add('mn-select-mobile')\n    menu.removeAttribute('class')\n    menu.removeAttribute('style')\n    cancelButton.textContent = 'cancel'\n\n    this.mobile = options\n    options.appendChild(menu)\n    options.appendChild(cancelButton)\n\n    document.body.appendChild(options)\n  }\n\n  setSelected() {\n    const viewValue = document.createElement('div')\n    const selectedOption = this.getAttribute('placeholder')\n      ? this.querySelector('.mn-select-option[selected]')\n      : this.querySelector('.mn-select-option[selected]')\n        || this.querySelector('.mn-select-option')\n\n    if (selectedOption) {\n      const value = selectedOption.getAttribute('value') || selectedOption.textContent\n      this.value = value\n      this.classList.add('has-value')\n      viewValue.textContent = selectedOption.textContent\n    } else if (this.getAttribute('value')) {\n      const value = this.getAttribute('value')\n      this.value = value\n      const option = document.querySelector(`.mn-select-option[value='${value}']`)\n\n      if (option) {\n        viewValue.textContent = option.textContent\n      }\n    }\n\n    this.insertBefore(viewValue, this.firstChild)\n  }\n\n  setOptionEvents() {\n    const options = this.querySelectorAll('.mn-select-option')\n    const mobile = Array.from(this.mobile.querySelectorAll('.mn-select-option'))\n\n    Array\n      .from(options)\n      .concat(mobile)\n      .forEach(option => option.addEventListener('click', event => {\n        const value = event.target.getAttribute('value') || event.target.textContent\n        this.value = value\n        this.close()\n      }))\n\n    Array\n      .from(options)\n      .forEach(option => option.addEventListener('mousemove', event => {\n        event.target.focus()\n        event.target.classList.remove('keydown')\n      }))\n\n    Array\n      .from(options)\n      .forEach(option => option.addEventListener('keydown', event => {\n        let nextFocusable\n        switch (event.key) {\n          case 'ArrowDown':\n            nextFocusable = event.target.nextElementSibling\n            break\n          case 'ArrowUp':\n            nextFocusable = event.target.previousElementSibling\n            break\n        }\n\n        if (nextFocusable) {\n          event.target.classList.add('keydown')\n          nextFocusable.focus()\n          event.stopPropagation()\n          event.preventDefault()\n        }\n      }))\n\n    Array\n      .from(options)\n      .forEach(option => option.addEventListener('keydown', event => {\n        if (event.key === 'Enter') {\n          const value = event.target.getAttribute('value') || event.target.textContent\n          this.value = value\n          this.close()\n          this.focus()\n          event.stopPropagation()\n        }\n      }))\n  }\n\n  setOpenEvents() {\n    this.addEventListener('click', event => {\n      this.open()\n      this.focusOption(event)\n    })\n    this.addEventListener('keydown', event => {\n      switch (event.key) {\n        case 'Enter':\n        case ' ':\n          this.open()\n          this.focusOption(event)\n          event.preventDefault()\n      }\n    })\n  }\n\n  setCloseEvents() {\n    this.addEventListener('focus', () => this.close())\n    this.mobile.querySelector('button').addEventListener('click', () => this.close())\n    this.mobile.addEventListener('click', event => {\n      if (event.target.classList.contains('mn-select-mobile')) {\n        this.close()\n      }\n    })\n\n    document.addEventListener('keydown', event => {\n      const hasFilter = this.filterString\n      const esc = event.key === 'Escape'\n      const isOpened = this.classList.contains('visible')\n      const isCharacter = event.key.length === 1\n\n      if (isOpened) {\n        if (isCharacter) {\n          this.filterString += event.key\n          this.filter = this.filterString\n        }\n\n        if (event.key === 'Backspace') {\n          this.filterString = this.filterString.slice(0, -1)\n          this.filter = this.filterString\n        }\n\n        if (esc) {\n          if (hasFilter) {\n            this.filter = undefined\n          } else {\n            this.close()\n          }\n        }\n      }\n    })\n    document.addEventListener('click', event => {\n      const clickOutside = !event.target.closest('mn-select')\n      const selectOption = event.target.classList.contains('mn-select-option')\n\n      if (clickOutside || selectOption) {\n        this.close()\n      }\n    })\n  }\n\n  setFormGetter() {\n    const form = this.closest('form')\n    const name = this.getAttribute('name')\n    const element = this\n\n    if (form && name) {\n      Object.defineProperty(form, name, {get: () => element})\n    }\n  }\n\n  setValidation() {\n    const required = this.getAttribute('required')\n    if (required) {\n      const input = document.createElement('input')\n      input.setAttribute('required', 'required')\n      input.setAttribute('name', this.getAttribute('name') || this.id)\n      input.style.visibility = 'hidden'\n      input.style.position = 'absolute'\n      this.appendChild(input)\n    }\n  }\n\n  set value(value) {\n    value = typeof value === 'object'\n      ? JSON.stringify(value)\n      : value\n\n    const option = this.querySelector(`.mn-select-option[value='${value}']`)\n    const input = this.querySelector('input')\n\n    if (option) {\n      const viewValue = this.querySelector('div:not(.mn-select-option)')\n      viewValue\n        ? viewValue.textContent = option.textContent\n        : null\n      if (input) {\n        input.value = value\n      }\n      this.classList.add('has-value')\n      const lastSelected = option.parentNode.querySelector('.mn-select-option[selected]')\n\n      if (lastSelected) {\n        lastSelected.removeAttribute('selected')\n      }\n      option.setAttribute('selected', 'selected')\n    } else {\n      console.error(`MN-SELECT OPTION_UNDEFINED\n        You're trying set a value (${value}) to mn-select,\n        but there is no option with this value to be displayed`)\n    }\n\n    this.validate()\n    const changeEvent = new CustomEvent('change', {value})\n    this.dispatchEvent(changeEvent)\n    this.setAttribute('value', value)\n  }\n\n  get value() {\n    let attrValue\n    try {\n      attrValue = this.getAttribute('value')\n        ? JSON.parse(this.getAttribute('value'))\n        : this.getAttribute('value')\n    } catch (e) {\n      attrValue = this.getAttribute('value')\n    }\n\n    return attrValue || undefined\n  }\n\n  set filter(value) {\n    if (value) {\n      this.filterString = value\n      const options = Array.from(this.menu.querySelectorAll('.mn-select-option'))\n      options.forEach(option => {\n        const matchOption = filterByRegex(value, option.textContent)\n        matchOption\n          ? option.classList.remove('hidden')\n          : option.classList.add('hidden')\n      })\n    } else {\n      this.filterString = ''\n      const hiddenOptions = Array.from(this.querySelectorAll('.mn-select-option.hidden'))\n      hiddenOptions.forEach(option => option.classList.remove('hidden'))\n    }\n\n    function filterByRegex(search, value) {\n      const reg = new RegExp(search.split('').join('.*'), 'i')\n      return reg.test(value)\n    }\n  }\n\n  get filter() {\n    return this.filterString || undefined\n  }\n\n  open() {\n    this.close()\n    this.classList.add('visible')\n    this.mobile.classList.add('visible')\n    document.body.classList.add('mn-select-visible')\n    window.MnBackdrop.show()\n  }\n\n  close() {\n    const select = document.querySelector('mn-select.visible')\n\n    if (select) {\n      select.classList.remove('visible')\n      select.filter = undefined\n      select.mobile.classList.remove('visible')\n      document.body.classList.remove('mn-select-visible')\n      window.MnBackdrop.hide()\n    }\n  }\n\n  focusOption(event) {\n    if (event.type === 'click') {\n      // focus on option behind mouse\n      const option = document.elementFromPoint(event.clientX, event.clientY)\n      option.focus()\n    } else if (event.type === 'keydown') {\n      const option = this.querySelector('.mn-select-option[selected]')\n        || this.querySelector('.mn-select-option:first-child')\n      option.focus()\n    }\n  }\n\n  // filter(value) {\n  //   if (value) {\n  //     const options = Array.from(this.menu.querySelectorAll('.mn-select-option'))\n  //     options.forEach(option => {\n  //       const matchOption = filterByRegex(value, option.textContent)\n  //       matchOption\n  //         ? option.classList.remove('hidden')\n  //         : option.classList.add('hidden')\n  //     })\n  //   }\n\n  //   function filterByRegex(search, value) {\n  //     const reg = new RegExp(search.split('').join('.*'), 'i')\n  //     return reg.test(value)\n  //   }\n  // }\n\n  // removeFilter() {\n  //   const hiddenOptions = Array.from(this.querySelectorAll('.mn-select-option.hidden'))\n  //   hiddenOptions.forEach(option => option.classList.remove('hidden'))\n  // }\n}\n\nwindow.customElements.define('mn-select', MnSelect)\n\n"]}